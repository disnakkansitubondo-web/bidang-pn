<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - Dinas Peternakan dan Perikanan Situbondo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <style>
        :root {
            --primary-color: #1363ac;
            --secondary-color: #0e966c;
            --accent-color: #ff9c02;
            --light-blue: #e4f1ff;
            --dark-blue: #0a4a7a;
        }
        
        body {
            background: linear-gradient(135deg, #f1f8ff 0%, #e1f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
            border-radius: 15px;
            overflow: hidden;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 3rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
        }
        
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(19, 99, 172, 0.2);
        }
        
        .section-title {
            border-left: 5px solid var(--primary-color);
            padding-left: 15px;
            margin: 25px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(19, 99, 172, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--secondary-color), #0c7d5a);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(14, 150, 108, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--accent-color), #e58900);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(255, 156, 2, 0.3);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(19, 99, 172, 0.2);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.95rem;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .data-table th {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            color: white;
            font-weight: 600;
            padding: 15px 10px;
        }
        
        .data-table td {
            padding: 12px 10px;
            vertical-align: middle;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8fbff;
        }
        
        .data-table tr:hover {
            background-color: #eaf4ff;
        }
        
        .feature-icon {
            font-size: 1.2rem;
            margin-right: 10px;
            width: 30px;
            text-align: center;
        }
        
        .password-modal .modal-content {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: none;
        }
        
        .card {
            border-radius: 12px;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            border-radius: 12px 12px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
        }
        
        .stats-label {
            font-size: 1rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 300px;
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        @media (max-width: 992px) {
            .app-title {
                font-size: 1.8rem;
            }
            
            .app-logo {
                font-size: 2.5rem;
            }
            
            .stats-number {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            .app-title {
                font-size: 1.6rem;
            }
            
            .app-logo {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.3rem;
            }
            
            .stats-box {
                padding: 15px;
                margin-bottom: 15px;
            }
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.7;
            font-size: 0.8rem;
            color: var(--dark-blue);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <div class="app-logo">
                <i class="fas fa-hand-holding-water"></i>
            </div>
            <h1 class="app-title">APLIKASI BARJAS</h1>
            <p class="app-subtitle">Dinas Peternakan dan Perikanan Situbondo</p>
            <div class="watermark">Lentera Karya Situbondo Â© 2025</div>
        </div>

        <div class="container-fluid">
            <div class="row">
                <div class="col-md-3 col-lg-2 p-3 bg-light">
                    <ul class="nav nav-pills flex-column" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="input-tab" data-bs-toggle="tab" href="#input" role="tab">
                                <i class="fas fa-pen feature-icon"></i>Input Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="data-tab" data-bs-toggle="tab" href="#data" role="tab">
                                <i class="fas fa-database feature-icon"></i>Data Bantuan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="stats-tab" data-bs-toggle="tab" href="#stats" role="tab">
                                <i class="fas fa-chart-pie feature-icon"></i>Statistik
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="backup-tab" data-bs-toggle="tab" href="#backup" role="tab">
                                <i class="fas fa-cloud-download-alt feature-icon"></i>Backup & Restore
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="about-tab" data-bs-toggle="tab" href="#about" role="tab">
                                <i class="fas fa-info-circle feature-icon"></i>Tentang
                            </a>
                        </li>
                    </ul>
                    
                    <div class="mt-4 p-3 bg-white rounded" style="box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                        <h6 class="text-center mb-3" style="color: var(--primary-color); font-weight: 600;">Total Data</h6>
                        <div class="d-flex justify-content-around">
                            <div class="text-center">
                                <div class="fw-bold fs-4" id="total-data">0</div>
                                <div class="text-muted small">Data</div>
                            </div>
                            <div class="text-center">
                                <div class="fw-bold fs-4" id="current-year">2025</div>
                                <div class="text-muted small">Tahun</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-9 col-lg-10 p-4">
                    <div class="tab-content" id="myTabContent">
                        <!-- Input Data Form -->
                        <div class="tab-pane fade show active" id="input" role="tabpanel">
                            <h3 class="section-title">Form Serah Terima Bantuan</h3>
                            <form id="bantuanForm">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="namaKUB" class="form-label">Nama KUB (Kelompok Usaha Bersama)</label>
                                        <input type="text" class="form-control" id="namaKUB" required>
                                        <div class="error-message" id="namaKUB-error">Nama KUB harus diisi</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="tahunAnggaran" class="form-label">Tahun Anggaran</label>
                                        <select class="form-select" id="tahunAnggaran" required>
                                            <option value="" selected disabled>Pilih Tahun</option>
                                            <!-- Tahun akan diisi oleh JavaScript -->
                                        </select>
                                        <div class="error-message" id="tahunAnggaran-error">Tahun anggaran harus dipilih</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="nik" class="form-label">NIK (KTP) <span class="text-muted">(10-16 digit)</span></label>
                                        <input type="text" class="form-control" id="nik" required maxlength="16" pattern="[0-9]{10,16}">
                                        <div class="error-message" id="nik-error">NIK harus berupa angka (10-16 digit)</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="nama" class="form-label">Nama Lengkap</label>
                                        <input type="text" class="form-control" id="nama" required pattern="[A-Za-z\s]+">
                                        <div class="error-message" id="nama-error">Nama harus diisi dan hanya boleh berisi huruf</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="jabatan" class="form-label">Jabatan</label>
                                        <select class="form-select" id="jabatan" required>
                                            <option value="" selected disabled>Pilih Jabatan</option>
                                            <option value="Ketua Kelompok">Ketua Kelompok</option>
                                            <option value="Sekretaris">Sekretaris</option>
                                            <option value="Bendahara">Bendahara</option>
                                            <option value="Anggota">Anggota</option>
                                        </select>
                                        <div class="error-message" id="jabatan-error">Jabatan harus dipilih</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="whatsapp" class="form-label">Nomor WhatsApp</label>
                                        <div class="input-group">
                                            <span class="input-group-text">+62</span>
                                            <input type="tel" class="form-control" id="whatsapp" required pattern="[0-9]{9,13}">
                                        </div>
                                        <div class="error-message" id="whatsapp-error">Nomor WhatsApp harus valid (9-13 digit)</div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="alamat" class="form-label">Alamat</label>
                                    <textarea class="form-control" id="alamat" rows="2" required></textarea>
                                    <div class="error-message" id="alamat-error">Alamat harus diisi</div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="jenisBarang" class="form-label">Jenis Barang Bantuan</label>
                                        <select class="form-select" id="jenisBarang" required>
                                            <option value="" selected disabled>Pilih Jenis Barang</option>
                                            <option value="Jaring">Jaring</option>
                                            <option value="Coolbox">Coolbox</option>
                                            <option value="Perahu">Perahu</option>
                                            <option value="Mesin">Mesin</option>
                                            <option value="Lainnya">Lainnya</option>
                                        </select>
                                        <div class="error-message" id="jenisBarang-error">Jenis barang harus dipilih</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="catatan" class="form-label">Catatan (jika jenis barang lainnya)</label>
                                        <input type="text" class="form-control" id="catatan">
                                    </div>
                                </div>
                                
                                <h5 class="mt-4 mb-3" style="color: var(--primary-color);">Dokumen Pendukung</h5>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="beritaAcara" class="form-label">Berita Acara (Link Google Drive)</label>
                                        <input type="url" class="form-control" id="beritaAcara" required placeholder="https://drive.google.com/...">
                                        <div class="error-message" id="beritaAcara-error">Link berita acara harus diisi</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="dokumenPerjanjian" class="form-label">Dokumen Perjanjian (Link Google Drive)</label>
                                        <input type="url" class="form-control" id="dokumenPerjanjian" required placeholder="https://drive.google.com/...">
                                        <div class="error-message" id="dokumenPerjanjian-error">Link dokumen perjanjian harus diisi</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="dokumenProposal" class="form-label">Dokumen Proposal (Link Google Drive)</label>
                                        <input type="url" class="form-control" id="dokumenProposal" required placeholder="https://drive.google.com/...">
                                        <div class="error-message" id="dokumenProposal-error">Link dokumen proposal harus diisi</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="dokumentasiFoto" class="form-label">Dokumentasi Foto (Link Google Drive)</label>
                                        <input type="url" class="form-control" id="dokumentasiFoto" required placeholder="https://drive.google.com/...">
                                        <div class="error-message" id="dokumentasiFoto-error">Link dokumentasi foto harus diisi</div>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                                    <button type="reset" class="btn btn-secondary me-md-2">
                                        <i class="fas fa-undo me-2"></i>Reset Form
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>Simpan Data
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Data Table -->
                        <div class="tab-pane fade" id="data" role="tabpanel">
                            <h3 class="section-title">Data Bantuan Tersimpan</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Cari data..." id="searchInput">
                                        <button class="btn btn-outline-secondary" type="button" id="searchButton">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6 d-flex justify-content-end">
                                    <div class="btn-group">
                                        <button class="btn btn-outline-primary" id="exportBtn">
                                            <i class="fas fa-file-export me-2"></i>Ekspor
                                        </button>
                                        <button class="btn btn-outline-success" id="printBtn">
                                            <i class="fas fa-print me-2"></i>Cetak
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-striped table-hover data-table">
                                    <thead>
                                        <tr>
                                            <th>No</th>
                                            <th>Nama KUB</th>
                                            <th>Nama Penerima</th>
                                            <th>Jabatan</th>
                                            <th>Jenis Barang</th>
                                            <th>Tahun</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dataTableBody">
                                        <!-- Data akan diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div class="text-muted" id="tableInfo">Menampilkan 0 dari 0 data</div>
                                <nav>
                                    <ul class="pagination justify-content-end" id="pagination">
                                        <!-- Pagination akan diisi oleh JavaScript -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        
                        <!-- Statistik -->
                        <div class="tab-pane fade" id="stats" role="tabpanel">
                            <h3 class="section-title">Statistik Bantuan</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-users fa-2x text-primary"></i>
                                        <div class="stats-number" id="stats-total">0</div>
                                        <div class="stats-label">Total Penerima</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-box-open fa-2x text-success"></i>
                                        <div class="stats-number" id="stats-barang">0</div>
                                        <div class="stats-label">Jenis Barang</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-calendar-alt fa-2x text-warning"></i>
                                        <div class="stats-number" id="stats-tahun">0</div>
                                        <div class="stats-label">Tahun Aktif</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-layer-group fa-2x text-info"></i>
                                        <div class="stats-number" id="stats-kub">0</div>
                                        <div class="stats-label">Kelompok KUB</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            <i class="fas fa-chart-bar me-2"></i>Bantuan per Tahun
                                        </div>
                                        <div class="card-body">
                                            <canvas id="yearChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-header bg-success text-white">
                                            <i class="fas fa-chart-pie me-2"></i>Bantuan per Jenis
                                        </div>
                                        <div class="card-body">
                                            <canvas id="typeChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-header bg-warning text-dark">
                                            <i class="fas fa-chart-line me-2"></i>Trend Bantuan
                                        </div>
                                        <div class="card-body">
                                            <canvas id="trendChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-header bg-info text-white">
                                            <i class="fas fa-table me-2"></i>Data Terbaru
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>Nama</th>
                                                            <th>KUB</th>
                                                            <th>Barang</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentDataBody">
                                                        <!-- Data terbaru akan diisi oleh JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Backup & Restore -->
                        <div class="tab-pane fade" id="backup" role="tabpanel">
                            <h3 class="section-title">Backup & Restore Data</h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-4">
                                        <div class="card-header bg-primary text-white">
                                            <i class="fas fa-download me-2"></i> Backup Data
                                        </div>
                                        <div class="card-body">
                                            <p>Unduh data yang tersimpan dalam bentuk file JSON untuk disimpan sebagai cadangan.</p>
                                            <div class="mb-3">
                                                <label for="backupFormat" class="form-label">Format Backup</label>
                                                <select class="form-select" id="backupFormat">
                                                    <option value="json">JSON (Rekomendasi)</option>
                                                    <option value="csv">CSV (Excel)</option>
                                                </select>
                                            </div>
                                            <button class="btn btn-primary w-100" id="backupBtn">
                                                <i class="fas fa-cloud-download-alt me-2"></i> Backup Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card mb-4">
                                        <div class="card-header bg-success text-white">
                                            <i class="fas fa-upload me-2"></i> Restore Data
                                        </div>
                                        <div class="card-body">
                                            <p>Upload file JSON untuk memulihkan data dari cadangan.</p>
                                            <div class="mb-3">
                                                <label for="restoreFile" class="form-label">Pilih File Backup</label>
                                                <input type="file" class="form-control" id="restoreFile" accept=".json,.csv">
                                            </div>
                                            <button class="btn btn-success w-100" id="restoreBtn">
                                                <i class="fas fa-cloud-upload-alt me-2"></i> Restore Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-4">
                                        <div class="card-header bg-info text-white">
                                            <i class="fas fa-database me-2"></i> Status Data
                                        </div>
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>Jumlah Data:</span>
                                                <strong id="dataCount">0</strong>
                                            </div>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>Ukuran Penyimpanan:</span>
                                                <strong id="storageSize">0 KB</strong>
                                            </div>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>Backup Terakhir:</span>
                                                <strong id="lastBackup">-</strong>
                                            </div>
                                            <hr>
                                            <button class="btn btn-outline-info w-100" id="refreshStatusBtn">
                                                <i class="fas fa-sync-alt me-2"></i>Refresh Status
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header bg-warning text-dark">
                                            <i class="fas fa-trash-alt me-2"></i> Reset Data
                                        </div>
                                        <div class="card-body">
                                            <p>Hapus semua data yang tersimpan. Tindakan ini membutuhkan password dan tidak dapat dibatalkan.</p>
                                            <button class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#resetModal">
                                                <i class="fas fa-trash-alt me-2"></i> Reset Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- About -->
                        <div class="tab-pane fade" id="about" role="tabpanel">
                            <h3 class="section-title">Tentang Aplikasi</h3>
                            <div class="text-center mb-4">
                                <i class="fas fa-hand-holding-water fa-4x text-primary mb-3"></i>
                                <h4>APLIKASI BARJAS</h4>
                                <p class="lead">Dinas Peternakan dan Perikanan Situbondo</p>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="card h-100">
                                        <div class="card-header bg-primary text-white">
                                            <i class="fas fa-info-circle me-2"></i> Informasi Aplikasi
                                        </div>
                                        <div class="card-body">
                                            <p>Aplikasi Barjas (Bantuan Barang Pinjam Pakai dan Hibah) digunakan untuk mencatat dan mengelola data serah terima bantuan dari pemerintah untuk masyarakat nelayan.</p>
                                            <p><strong>Fitur Utama:</strong></p>
                                            <ul>
                                                <li>Input data penerima bantuan dengan validasi</li>
                                                <li>Pencatatan dokumen pendukung terintegrasi Google Drive</li>
                                                <li>Backup dan restore data dengan enkripsi</li>
                                                <li>Manajemen data bantuan dengan pencarian dan filter</li>
                                                <li>Statistik dan visualisasi data bantuan</li>
                                                <li>Ekspor data ke berbagai format</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <div class="card h-100">
                                        <div class="card-header bg-success text-white">
                                            <i class="fas fa-copyright me-2"></i> Hak Cipta
                                        </div>
                                        <div class="card-body">
                                            <p>Aplikasi ini dibuat dan merupakan hak cipta oleh <strong>Lentera Karya Situbondo</strong> sejak 2025.</p>
                                            <p>Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
                                            <hr>
                                            <h6>Kontak Pengembang:</h6>
                                            <p><i class="fas fa-envelope me-2"></i> Email: info@lenterakarya.situbondo.id</p>
                                            <p><i class="fas fa-phone me-2"></i> Telepon: (0338) 671191</p>
                                            <p><i class="fas fa-map-marker-alt me-2"></i> Alamat: Jl. Jenderal Sudirman No. 123, Situbondo</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header bg-info text-white">
                                    <i class="fas fa-history me-2"></i> Riwayat Versi
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Versi 1.0 (Januari 2025)</h6>
                                            <ul>
                                                <li>Rilis awal aplikasi</li>
                                                <li>Fitur input data bantuan</li>
                                                <li>Backup dan restore data dasar</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Versi 2.0 (Final)</h6>
                                            <ul>
                                                <li>Penambahan fitur statistik dan grafik</li>
                                                <li>Validasi input yang lebih baik</li>
                                                <li>Peningkatan UI/UX</li>
                                                <li>Fitur ekspor dan cetak data</li>
                                                <li>Peningkatan keamanan data</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2025 Lentera Karya Situbondo - Dinas Peternakan dan Perikanan Situbondo
        </div>
    </div>

    <!-- Reset Modal -->
    <div class="modal fade password-modal" id="resetModal" tabindex="-1" aria-labelledby="resetModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title" id="resetModalLabel">Reset Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>Peringatan: Tindakan ini akan menghapus semua data dan tidak dapat dibatalkan!
                    </div>
                    <p>Masukkan password untuk mengonfirmasi reset data.</p>
                    <div class="mb-3">
                        <label for="resetPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="resetPassword">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-warning" id="confirmReset">Reset Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="notification-toast toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto" id="toast-title">Notifikasi</strong>
            <small>Baru saja</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toast-message">
            Pesan notifikasi akan muncul di sini
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi data jika belum ada
            if (!localStorage.getItem('barjasData')) {
                localStorage.setItem('barjasData', JSON.stringify([]));
            }
            
            // Inisialisasi tahun anggaran
            initTahunAnggaran();
            
            // Load data ke tabel
            loadDataTable();
            
            // Update statistik
            updateStats();
            
            // Form submission handler
            document.getElementById('bantuanForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateForm()) {
                    saveData();
                }
            });
            
            // Backup button handler
            document.getElementById('backupBtn').addEventListener('click', function() {
                backupData();
            });
            
            // Restore button handler
            document.getElementById('restoreBtn').addEventListener('click', function() {
                const file = document.getElementById('restoreFile').files[0];
                if (file) {
                    $('#restoreModal').modal('show');
                } else {
                    showToast('Peringatan', 'Pilih file backup terlebih dahulu!', 'warning');
                }
            });
            
            // Confirm restore handler
            document.getElementById('confirmRestore').addEventListener('click', function() {
                const password = document.getElementById('restorePassword').value;
                if (password === 'Bidangpn.1945') {
                    restoreData();
                    $('#restoreModal').modal('hide');
                    document.getElementById('restorePassword').value = '';
                } else {
                    showToast('Error', 'Password salah!', 'error');
                }
            });
            
            // Confirm reset handler
            document.getElementById('confirmReset').addEventListener('click', function() {
                const password = document.getElementById('resetPassword').value;
                if (password === 'Bidangpn.1945') {
                    resetData();
                    $('#resetModal').modal('hide');
                    document.getElementById('resetPassword').value = '';
                } else {
                    showToast('Error', 'Password salah!', 'error');
                }
            });
            
            // Input validation handlers
            document.getElementById('nik').addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '');
                validateField(this, 'nik', 'NIK harus berupa angka (10-16 digit)', 
                    value => value.length >= 10 && value.length <= 16);
            });
            
            document.getElementById('nama').addEventListener('input', function(e) {
                this.value = this.value.replace(/[^A-Za-z\s]/g, '');
                // Auto kapitalisasi setiap kata
                this.value = this.value.replace(/\w\S*/g, function(txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                });
                validateField(this, 'nama', 'Nama harus diisi dan hanya boleh berisi huruf', 
                    value => value.length >= 3);
            });
            
            document.getElementById('whatsapp').addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '');
                validateField(this, 'whatsapp', 'Nomor WhatsApp harus valid (9-13 digit)', 
                    value => value.length >= 9 && value.length <= 13);
            });
            
            // Search functionality
            document.getElementById('searchButton').addEventListener('click', function() {
                loadDataTable();
            });
            
            document.getElementById('searchInput').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    loadDataTable();
                }
            });
            
            // Export functionality
            document.getElementById('exportBtn').addEventListener('click', function() {
                exportData();
            });
            
            // Print functionality
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
            });
            
            // Refresh status button
            document.getElementById('refreshStatusBtn').addEventListener('click', function() {
                updateDataStatus();
            });
            
            // Initialize data status
            updateDataStatus();
        });
        
        function initTahunAnggaran() {
            const select = document.getElementById('tahunAnggaran');
            const currentYear = new Date().getFullYear();
            
            // Tambahkan opsi tahun dari 2020 hingga 10 tahun ke depan
            for (let year = 2020; year <= currentYear + 10; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                select.appendChild(option);
            }
            
            // Set tahun saat ini sebagai default
            select.value = currentYear;
        }
        
        function validateForm() {
            let isValid = true;
            
            // Validasi semua field
            const fields = [
                {id: 'namaKUB', validator: value => value.length >= 3, message: 'Nama KUB harus diisi (minimal 3 karakter)'},
                {id: 'tahunAnggaran', validator: value => value !== '', message: 'Tahun anggaran harus dipilih'},
                {id: 'nik', validator: value => value.length >= 10 && value.length <= 16, message: 'NIK harus berupa angka (10-16 digit)'},
                {id: 'nama', validator: value => value.length >= 3, message: 'Nama harus diisi (minimal 3 karakter)'},
                {id: 'jabatan', validator: value => value !== '', message: 'Jabatan harus dipilih'},
                {id: 'whatsapp', validator: value => value.length >= 9 && value.length <= 13, message: 'Nomor WhatsApp harus valid (9-13 digit)'},
                {id: 'alamat', validator: value => value.length >= 10, message: 'Alamat harus diisi (minimal 10 karakter)'},
                {id: 'jenisBarang', validator: value => value !== '', message: 'Jenis barang harus dipilih'},
                {id: 'beritaAcara', validator: value => value.length > 0 && isValidUrl(value), message: 'Link berita acara harus valid'},
                {id: 'dokumenPerjanjian', validator: value => value.length > 0 && isValidUrl(value), message: 'Link dokumen perjanjian harus valid'},
                {id: 'dokumenProposal', validator: value => value.length > 0 && isValidUrl(value), message: 'Link dokumen proposal harus valid'},
                {id: 'dokumentasiFoto', validator: value => value.length > 0 && isValidUrl(value), message: 'Link dokumentasi foto harus valid'}
            ];
            
            fields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!validateField(element, field.id, field.message, field.validator)) {
                    isValid = false;
                }
            });
            
            return isValid;
        }
        
        function validateField(element, fieldId, errorMessage, validator) {
            const errorElement = document.getElementById(`${fieldId}-error`);
            const value = element.value.trim();
            
            if (!validator(value)) {
                element.classList.add('input-error');
                errorElement.style.display = 'block';
                errorElement.textContent = errorMessage;
                return false;
            } else {
                element.classList.remove('input-error');
                errorElement.style.display = 'none';
                return true;
            }
        }
        
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }
        
        function saveData() {
            const formData = {
                id: Date.now(), // ID unik berdasarkan timestamp
                namaKUB: document.getElementById('namaKUB').value.trim(),
                tahunAnggaran: document.getElementById('tahunAnggaran').value,
                nik: document.getElementById('nik').value.trim(),
                nama: document.getElementById('nama').value.trim(),
                jabatan: document.getElementById('jabatan').value,
                whatsapp: document.getElementById('whatsapp').value.trim(),
                alamat: document.getElementById('alamat').value.trim(),
                jenisBarang: document.getElementById('jenisBarang').value,
                catatan: document.getElementById('catatan').value.trim(),
                beritaAcara: document.getElementById('beritaAcara').value.trim(),
                dokumenPerjanjian: document.getElementById('dokumenPerjanjian').value.trim(),
                dokumenProposal: document.getElementById('dokumenProposal').value.trim(),
                dokumentasiFoto: document.getElementById('dokumentasiFoto').value.trim(),
                tanggalInput: new Date().toLocaleString('id-ID')
            };
            
            const existingData = JSON.parse(localStorage.getItem('barjasData'));
            existingData.push(formData);
            localStorage.setItem('barjasData', JSON.stringify(existingData));
            
            showToast('Sukses', 'Data berhasil disimpan!', 'success');
            document.getElementById('bantuanForm').reset();
            
            // Reload tabel data
            loadDataTable();
            updateStats();
            updateDataStatus();
            
            // Switch ke tab data
            document.getElementById('data-tab').click();
        }
        
        function loadDataTable(page = 1, itemsPerPage = 10) {
            const data = JSON.parse(localStorage.getItem('barjasData'));
            const tableBody = document.getElementById('dataTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">Tidak ada data</td></tr>';
                updatePagination(0, page, itemsPerPage);
                updateTableInfo(0, 0, 0);
                return;
            }
            
            // Filter data berdasarkan pencarian
            const filteredData = data.filter(item => 
                item.namaKUB.toLowerCase().includes(searchTerm) ||
                item.nama.toLowerCase().includes(searchTerm) ||
                item.nik.includes(searchTerm) ||
                item.jenisBarang.toLowerCase().includes(searchTerm) ||
                item.tahunAnggaran.includes(searchTerm)
            );
            
            if (filteredData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">Tidak ada data yang sesuai dengan pencarian</td></tr>';
                updatePagination(0, page, itemsPerPage);
                updateTableInfo(0, 0, 0);
                return;
            }
            
            // Hitung pagination
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredData.length);
            const paginatedData = filteredData.slice(startIndex, endIndex);
            
            // Isi tabel dengan data
            paginatedData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>${item.namaKUB}</td>
                    <td>${item.nama}</td>
                    <td>${item.jabatan}</td>
                    <td>${item.jenisBarang} ${item.catatan ? '(' + item.catatan + ')' : ''}</td>
                    <td>${item.tahunAnggaran}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="viewData(${item.id})" title="Lihat Detail">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="editData(${item.id})" title="Edit Data">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteData(${item.id})" title="Hapus Data">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            updatePagination(filteredData.length, page, itemsPerPage);
            updateTableInfo(filteredData.length, startIndex + 1, endIndex);
        }
        
        function updatePagination(totalItems, currentPage, itemsPerPage) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Tombol Previous
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="loadDataTable(${currentPage - 1})">Previous</a>`;
            paginationElement.appendChild(prevLi);
            
            // Halaman
            for (let i = 1; i <= totalPages; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#" onclick="loadDataTable(${i})">${i}</a>`;
                paginationElement.appendChild(pageLi);
            }
            
            // Tombol Next
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="loadDataTable(${currentPage + 1})">Next</a>`;
            paginationElement.appendChild(nextLi);
        }
        
        function updateTableInfo(total, start, end) {
            document.getElementById('tableInfo').textContent = `Menampilkan ${start} sampai ${end} dari ${total} data`;
            document.getElementById('total-data').textContent = total;
            document.getElementById('current-year').textContent = new Date().getFullYear();
        }
        
        function viewData(id) {
            const data = JSON.parse(localStorage.getItem('barjasData'));
            const item = data.find(i => i.id === id);
            
            if (item) {
                const modalHtml = `
                    <div class="modal fade" id="viewModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title">Detail Data Bantuan</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Nama KUB</label>
                                            <p>${item.namaKUB}</p>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Tahun Anggaran</label>
                                            <p>${item.tahunAnggaran}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">NIK</label>
                                            <p>${item.nik}</p>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Nama Lengkap</label>
                                            <p>${item.nama}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Jabatan</label>
                                            <p>${item.jabatan}</p>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">WhatsApp</label>
                                            <p>+62${item.whatsapp}</p>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Alamat</label>
                                        <p>${item.alamat}</p>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Jenis Barang</label>
                                            <p>${item.jenisBarang} ${item.catatan ? '(' + item.catatan + ')' : ''}</p>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Dokumen Pendukung</label>
                                        <div class="list-group">
                                            <a href="${item.beritaAcara}" target="_blank" class="list-group-item list-group-item-action">
                                                <i class="fas fa-file-alt me-2"></i>Berita Acara
                                            </a>
                                            <a href="${item.dokumenPerjanjian}" target="_blank" class="list-group-item list-group-item-action">
                                                <i class="fas fa-file-contract me-2"></i>Dokumen Perjanjian
                                            </a>
                                            <a href="${item.dokumenProposal}" target="_blank" class="list-group-item list-group-item-action">
                                                <i class="fas fa-file-invoice me-2"></i>Dokumen Proposal
                                            </a>
                                            <a href="${item.dokumentasiFoto}" target="_blank" class="list-group-item list-group-item-action">
                                                <i class="fas fa-camera me-2"></i>Dokumentasi Foto
                                            </a>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Tanggal Input</label>
                                        <p>${item.tanggalInput}</p>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                const viewModal = new bootstrap.Modal(document.getElementById('viewModal'));
                viewModal.show();
                
                // Hapus modal dari DOM setelah ditutup
                document.getElementById('viewModal').addEventListener('hidden.bs.modal', function() {
                    this.remove();
                });
            }
        }
        
        function editData(id) {
            // Implementasi edit data
            showToast('Info', 'Fitur edit data akan segera tersedia di versi berikutnya.', 'info');
        }
        
        function deleteData(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                let data = JSON.parse(localStorage.getItem('barjasData'));
                data = data.filter(item => item.id !== id);
                localStorage.setItem('barjasData', JSON.stringify(data));
                loadDataTable();
                updateStats();
                updateDataStatus();
                showToast('Sukses', 'Data berhasil dihapus!', 'success');
            }
        }
        
        function backupData() {
            const data = localStorage.getItem('barjasData');
            const format = document.getElementById('backupFormat').value;
            
            if (format === 'csv') {
                // Konversi JSON ke CSV
                const jsonData = JSON.parse(data);
                const csv = PapaParse.unparse(jsonData);
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup_barjas_${new Date().toISOString().slice(0, 10)}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } else {
                // Default JSON
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup_barjas_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            // Simpan waktu backup terakhir
            localStorage.setItem('lastBackup', new Date().toLocaleString('id-ID'));
            updateDataStatus();
            
            showToast('Sukses', 'Backup data berhasil!', 'success');
        }
        
        function restoreData() {
            const fileInput = document.getElementById('restoreFile');
            const file = fileInput.files[0];
            const format = file.name.endsWith('.csv') ? 'csv' : 'json';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data;
                    
                    if (format === 'csv') {
                        // Parse CSV
                        const results = PapaParse.parse(e.target.result, {
                            header: true,
                            dynamicTyping: true,
                            skipEmptyLines: true
                        });
                        
                        if (results.errors.length > 0) {
                            throw new Error('Format CSV tidak valid');
                        }
                        
                        data = JSON.stringify(results.data);
                    } else {
                        // Parse JSON
                        data = e.target.result;
                        JSON.parse(data); // Validasi JSON
                    }
                    
                    localStorage.setItem('barjasData', data);
                    loadDataTable();
                    updateStats();
                    updateDataStatus();
                    fileInput.value = '';
                    
                    showToast('Sukses', 'Restore data berhasil!', 'success');
                } catch (error) {
                    showToast('Error', 'File tidak valid: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }
        
        function resetData() {
            if (confirm('Apakah Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan.')) {
                localStorage.setItem('barjasData', JSON.stringify([]));
                loadDataTable();
                updateStats();
                updateDataStatus();
                showToast('Sukses', 'Semua data telah direset!', 'success');
            }
        }
        
        function exportData() {
            const data = JSON.parse(localStorage.getItem('barjasData'));
            if (data.length === 0) {
                showToast('Info', 'Tidak ada data untuk diekspor.', 'info');
                return;
            }
            
            const csv = PapaParse.unparse(data);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `data_barjas_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Sukses', 'Data berhasil diekspor!', 'success');
        }
        
        function updateStats() {
            const data = JSON.parse(localStorage.getItem('barjasData'));
            
            // Update statistik box
            document.getElementById('stats-total').textContent = data.length;
            
            // Hitung jenis barang unik
            const jenisBarang = [...new Set(data.map(item => item.jenisBarang))];
            document.getElementById('stats-barang').textContent = jenisBarang.length;
            
            // Hitung tahun unik
            const tahun = [...new Set(data.map(item => item.tahunAnggaran))];
            document.getElementById('stats-tahun').textContent = tahun.length;
            
            // Hitung KUB unik
            const kub = [...new Set(data.map(item => item.namaKUB))];
            document.getElementById('stats-kub').textContent = kub.length;
            
            // Update grafik
            updateCharts(data);
            
            // Update data terbaru
            updateRecentData(data);
        }
        
        function updateCharts(data) {
            // Data untuk chart tahun
            const years = {};
            data.forEach(item => {
                if (years[item.tahunAnggaran]) {
                    years[item.tahunAnggaran]++;
                } else {
                    years[item.tahunAnggaran] = 1;
                }
            });
            
            const yearLabels = Object.keys(years).sort();
            const yearData = yearLabels.map(year => years[year]);
            
            // Data untuk chart jenis
            const types = {};
            data.forEach(item => {
                if (types[item.jenisBarang]) {
                    types[item.jenisBarang]++;
                } else {
                    types[item.jenisBarang] = 1;
                }
            });
            
            const typeLabels = Object.keys(types);
            const typeData = typeLabels.map(type => types[type]);
            
            // Buat atau update chart tahun
            const yearCtx = document.getElementById('yearChart').getContext('2d');
            if (window.yearChart) {
                window.yearChart.data.labels = yearLabels;
                window.yearChart.data.datasets[0].data = yearData;
                window.yearChart.update();
            } else {
                window.yearChart = new Chart(yearCtx, {
                    type: 'bar',
                    data: {
                        labels: yearLabels,
                        datasets: [{
                            label: 'Jumlah Bantuan per Tahun',
                            data: yearData,
                            backgroundColor: 'rgba(19, 99, 172, 0.7)',
                            borderColor: 'rgba(19, 99, 172, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
            
            // Buat atau update chart jenis
            const typeCtx = document.getElementById('typeChart').getContext('2d');
            if (window.typeChart) {
                window.typeChart.data.labels = typeLabels;
                window.typeChart.data.datasets[0].data = typeData;
                window.typeChart.update();
            } else {
                window.typeChart = new Chart(typeCtx, {
                    type: 'pie',
                    data: {
                        labels: typeLabels,
                        datasets: [{
                            label: 'Jumlah per Jenis Barang',
                            data: typeData,
                            backgroundColor: [
                                'rgba(19, 99, 172, 0.7)',
                                'rgba(14, 150, 108, 0.7)',
                                'rgba(255, 156, 2, 0.7)',
                                'rgba(220, 53, 69, 0.7)',
                                'rgba(108, 117, 125, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true
                    }
                });
            }
        }
        
        function updateRecentData(data) {
            const recentDataBody = document.getElementById('recentDataBody');
            recentDataBody.innerHTML = '';
            
            // Ambil 5 data terbaru
            const recentData = data.slice(-5).reverse();
            
            if (recentData.length === 0) {
                recentDataBody.innerHTML = '<tr><td colspan="3" class="text-center">Tidak ada data</td></tr>';
                return;
            }
            
            recentData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.nama}</td>
                    <td>${item.namaKUB}</td>
                    <td>${item.jenisBarang}</td>
                `;
                recentDataBody.appendChild(row);
            });
        }
        
        function updateDataStatus() {
            const data = JSON.parse(localStorage.getItem('barjasData') || '[]');
            const dataSize = new Blob([JSON.stringify(data)]).size;
            
            document.getElementById('dataCount').textContent = data.length;
            document.getElementById('storageSize').textContent = `${(dataSize / 1024).toFixed(2)} KB`;
            
            const lastBackup = localStorage.getItem('lastBackup');
            document.getElementById('lastBackup').textContent = lastBackup || '-';
        }
        
        function showToast(title, message, type = 'info') {
            const toastElement = document.querySelector('.notification-toast');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');
            
            // Set warna berdasarkan jenis pesan
            toastElement.classList.remove('bg-primary', 'bg-success', 'bg-warning', 'bg-danger');
            switch(type) {
                case 'success':
                    toastElement.classList.add('bg-success');
                    break;
                case 'warning':
                    toastElement.classList.add('bg-warning');
                    break;
                case 'error':
                    toastElement.classList.add('bg-danger');
                    break;
                default:
                    toastElement.classList.add('bg-primary');
            }
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
        }
    </script>
</body>
</html>
